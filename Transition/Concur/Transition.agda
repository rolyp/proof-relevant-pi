-- The residual of a concurrent pair after a transition (residuation preserves concurrency).
-- There is an unpleasant case-explosion here because of the need to distinguish the แตโแต and แตโแต cases pairwise
-- across the three transitions.
module Transition.Concur.Transition where

   open import SharedModules
   open import Ext

   open import Action as แดฌ using (Action; _แดฌโฃ_; แดฌโฃ-sym); open แดฌ.Action; open แดฌ.Actionแต; open แดฌ.Actionแถ; open แดฌ._แดฌโฃ_
   open import Proc as แดพ using (Proc); open แดพ.Proc
   open import Ren as แดฟ using (Ren; push; pop; swap); open แดฟ.Renameable โฆ...โฆ
   open import Ren.Properties
   open import Transition as แต using (_โ[_-_]โ_); open แต._โ[_-_]โ_
   open import Transition.Ren
   open import Transition.Concur2
      using (
         Concur; Concurโ; module Concur; module Concurโ; Deltaโฒ; module Deltaโฒ; Delta; โ; โโ; โฃ-sym
      );
      open Concur; open Concurโ; open Deltaโฒ
   open import Transition.Concur.Ren2 using (/-preserves-แดฌโฃ; _*แตแตโฃ; _*แตแถโฃ; _*แถแตโฃ; _*แถแถโฃ)

   -- These are trivial to prove; one just pattern-matches the aโฃaโฒ component of ๐ธ and ๐ธโณ so that Agda can
   -- see that /-preserves-โฃ has the type required, and then use that. However, just postulate these so
   -- they don't become a factor in memory usage.
   postulate
      /-preserves-โฃแดฐแดฐแต : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฃaโฒ : a แดฌโฃ aโฒ} {aโฒโฃaโณ : aโฒ แดฌโฃ aโณ} {aโณโฃa : aโณ แดฌโฃ a}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                        (๐ธ : E โฃ[ aโฃaโฒ ] Eโฒ) โ Eโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : Eโณ โฃ[ aโณโฃa ] E) โ
                        Eโฒ/E (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ aโฃaโฒ aโฒโฃaโณ (แดฌโฃ-sym aโณโฃa) ] E/Eโฒ (โ ๐ธโณ)
      /-preserves-โฃแดฐแตแดฐ : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฃaโฒ : a แดฌโฃ aโฒ} {aโณโฃaโฒ : aโณ แดฌโฃ aโฒ} {aโฃaโณ : a แดฌโฃ aโณ}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                        (๐ธ : E โฃ[ aโฃaโฒ ] Eโฒ) โ Eโณ โฃ[ aโณโฃaโฒ ] Eโฒ โ (๐ธโณ : E โฃ[ aโฃaโณ ] Eโณ) โ
                        Eโฒ/E (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ aโฃaโฒ (แดฌโฃ-sym aโณโฃaโฒ) aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
      /-preserves-โฃแดฐแตแต : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฃaโฒ : a แดฌโฃ aโฒ} {aโณโฃaโฒ : aโณ แดฌโฃ aโฒ} {aโณโฃa : aโณ แดฌโฃ a}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                        (๐ธ : E โฃ[ aโฃaโฒ ] Eโฒ) โ Eโณ โฃ[ aโณโฃaโฒ ] Eโฒ โ (๐ธโณ : Eโณ โฃ[ aโณโฃa ] E) โ
                        E/Eโฒ (โ ๐ธโณ) โฃ[ /-preserves-แดฌโฃ (แดฌโฃ-sym aโณโฃa) aโณโฃaโฒ aโฃaโฒ ] Eโฒ/E (โ ๐ธ)
      /-preserves-โฃแตแดฐแดฐ : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฒโฃa : aโฒ แดฌโฃ a} {aโฒโฃaโณ : aโฒ แดฌโฃ aโณ} {aโฃaโณ : a แดฌโฃ aโณ}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                        (๐ธ : Eโฒ โฃ[ aโฒโฃa ] E) โ Eโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โฃ[ aโฃaโณ ] Eโณ) โ
                        E/Eโฒ (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ (แดฌโฃ-sym aโฒโฃa) aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
      /-preserves-โฃแตแดฐแต : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฒโฃa : aโฒ แดฌโฃ a} {aโฒโฃaโณ : aโฒ แดฌโฃ aโณ} {aโณโฃa : aโณ แดฌโฃ a}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                        (๐ธ : Eโฒ โฃ[ aโฒโฃa ] E) โ Eโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : Eโณ โฃ[ aโณโฃa ] E) โ
                        E/Eโฒ (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ (แดฌโฃ-sym aโฒโฃa) aโฒโฃaโณ (แดฌโฃ-sym aโณโฃa) ] E/Eโฒ (โ ๐ธโณ)
      /-preserves-โฃแตแตแดฐ : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฒโฃa : aโฒ แดฌโฃ a} {aโณโฃaโฒ : aโณ แดฌโฃ aโฒ} {aโฃaโณ : a แดฌโฃ aโณ}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ} โ
                        (๐ธ : Eโฒ โฃ[ aโฒโฃa ] E) โ Eโณ โฃ[ aโณโฃaโฒ ] Eโฒ โ (๐ธโณ : E โฃ[ aโฃaโณ ] Eโณ) โ
                        E/Eโฒ (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ (แดฌโฃ-sym aโฒโฃa) (แดฌโฃ-sym aโณโฃaโฒ) aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
      /-preserves-โฃแตแตแต : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฒโฃa : aโฒ แดฌโฃ a} {aโณโฃaโฒ : aโณ แดฌโฃ aโฒ} {aโณโฃa : aโณ แดฌโฃ a}
                        {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ} โ
                        (๐ธ : Eโฒ โฃ[ aโฒโฃa ] E) โ Eโณ โฃ[ aโณโฃaโฒ ] Eโฒ โ (๐ธโณ : Eโณ โฃ[ aโณโฃa ] E) โ
                        E/Eโฒ (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ (แดฌโฃ-sym aโฒโฃa) (แดฌโฃ-sym aโณโฃaโฒ) (แดฌโฃ-sym aโณโฃa) ] E/Eโฒ (โ ๐ธโณ)

   /-preserves-โฃ : โ {ฮ} {P : Proc ฮ} {a aโฒ aโณ R Rโฒ Rโณ} {aโฃaโฒ : a แดฌโฃ aโฒ} {aโฒโฃaโณ : aโฒ แดฌโฃ aโณ} {aโฃaโณ : a แดฌโฃ aโณ}
                   {E : P โ[ a - _ ]โ R} {Eโฒ : P โ[ aโฒ - _ ]โ Rโฒ} {Eโณ : P โ[ aโณ - _ ]โ Rโณ}
                   (๐ธ : E โฃ[ aโฃaโฒ ] Eโฒ) โ Eโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โฃ[ aโฃaโณ ] Eโณ) โ
                   Eโฒ/E (โ ๐ธ) โฃ[ /-preserves-แดฌโฃ aโฃaโฒ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)

{-
   โแตฅโข-preserves : โ {ฮ} {P Q : Proc ฮ} {x u y aโณ R Rโฒ Rโณ S Sโฒ} {aโฒโฃaโณ} {aโฃaโณ}
                   {E : P โ[ (x โข) แต - _ ]โ R} {F : Q โ[ (โข x) แต - _ ]โ S}
                   {Eโฒ : P โ[ (u โข) แต - _ ]โ Rโฒ} {Fโฒ : Q โ[ โข u โฉ y โช แถ - _ ]โ Sโฒ} {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                   (๐ธ : E โฃ[ แตโแต ] Eโฒ) (๐น : F โฃ[ แตโแถ ] Fโฒ) โ Eโฒ โโข Fโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โแตฅ F โฃ[ aโฃaโณ ] Eโณ) โ
                   Eโฒ/E (โ [ ๐ธ โแตฅโข ๐น ]) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โโข ๐นโฒ ] [ ๐ธโณ โแตฅโข ๐นโณ ] = [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โโข ๐นโฒ ]หก [ ๐ธโณ โแตฅโข ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ (โฃ-sym ๐ธโฒ) ๐ธโณ โโข /-preserves-โฃ ๐น (โฃ-sym ๐นโฒ) ๐นโณ ] ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธโณ ๐ธโฒ ๐ธ โแตฅโข /-preserves-โฃ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธโณ ๐ธโฒ ๐ธ โโข /-preserves-โฃ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โโขแต F ]หก [ ๐ธโณ โแตฅแต Fโฒ ]หก = [ ฮฝแตแถ [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โโขแต _ ] ]หก
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โโขแถ F ]หก [ ๐ธโณ โแตฅแถ Fโฒ ]หก = [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โโขแถ _ ]หก ]
   โแตฅโข-preserves ๐ธ ๐น [ Eโฒ แตโโข ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก = [ ฮฝแตแถ [ _ แตโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ] ]หก
   โแตฅโข-preserves ๐ธ ๐น [ Eโฒ แตโโข ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก = [ ฮฝโขแถ [ _ แถโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ] ]หก
   โแตฅโข-preserves ๐ธ ๐น [ Eโฒ แถโโข ๐นโฒ ]หก [ E แถโแตฅ ๐นโณ ]หก = [ ฮฝแถแถ [ _ แถโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅโข-preserves ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โโข โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅโข-preserves _ _ [ _ โโข _ ] [ () ]หก
   โแตฅโข-preserves _ _ [ _ โโขแต _ ]หก [ () ]
   โแตฅโข-preserves _ _ [ _ โโขแถ _ ]หก [ () ]
   โแตฅโข-preserves _ _ [ _ แตโโข _ ]หก [ () ]
   โแตฅโข-preserves _ _ [ _ แถโโข _ ]หก [ () ]
   โแตฅโข-preserves _ _ [ _ โโข _ ]หก [ () ]หก

   โแตฅโขหก-preserves : โ {ฮ} {P Q : Proc ฮ} {x u y aโณ R Rโฒ Rโณ S Sโฒ} {aโฃaโณ  : ฯ แถ แดฌโฃ aโณ} {aโฒโฃaโณ : ฯ แถ แดฌโฃ aโณ}
                   {E : P โ[ (x โข) แต - _ ]โ R} {F : Q โ[ (โข x) แต - _ ]โ S}
                   {Eโฒ : P โ[ (u โข) แต - _ ]โ Rโฒ} {Fโฒ : Q โ[ โข u โฉ y โช แถ - _ ]โ Sโฒ} {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                   (๐ธ : E โฃ[ แตโแต ] Eโฒ) (๐น : F โฃ[ แตโแถ ] Fโฒ) โ E โแตฅ F โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : Eโฒ โโข Fโฒ โฃ[ aโฃaโณ ] Eโณ) โ
                   Eโฒ/E (โ [ ๐ธ โแตฅโข ๐น ]หก) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ] [ ๐ธโณ โโข ๐นโณ ] =
      [ (pop y *แตแตโฃ) (/-preserves-โฃแดฐแตแต ๐ธโณ ๐ธโฒ ๐ธ) โแตฅโข /-preserves-โฃแดฐแตแต ๐นโณ ๐นโฒ ๐น ]
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ ๐ธโฒ โแตฅโข ๐นโฒ ] [ ๐ธโณ โโข ๐นโณ ]หก =
      [ (pop y *แตแตโฃ) (/-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ]
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ ๐ธโฒ โแตฅ ๐นโฒ ] [ ๐ธโณ โแตฅโข ๐นโณ ]หก =
      [ (pop y *แตแตโฃ) (/-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ]
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ _โแตฅแต_ {a = a} ๐ธโฒ F ]หก [ ๐ธโณ โโขแต Fโฒ ]หก
      with (pop y *แต) (E/Eโฒ (โ ๐ธ)) | (pop y *แต) (E/Eโฒ (โ ๐ธโณ)) | (pop y *แตแตโฃ) (โฃ-sym (/-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ))
   ... | _ | _ | pop-y*๐ธโฒ/Eโฒ rewrite popโpush y a = [ pop-y*๐ธโฒ/Eโฒ โแตฅแต _ ]หก
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ _โแตฅแถ_ {a = a} ๐ธโฒ F ]หก [ ๐ธโณ โโขแถ Fโฒ ]หก
      with (pop y *แต) (E/Eโฒ (โ ๐ธ)) | (pop y *แถ) (E/Eโฒ (โ ๐ธโณ)) | (pop y *แถแตโฃ) (โฃ-sym (/-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ))
   ... | _ | _ | pop-y*๐ธโฒ/Eโฒ rewrite popโpush y a = [ pop-y*๐ธโฒ/Eโฒ โแตฅแถ _ ]หก
   โแตฅโขหก-preserves {x = x} {y = y} ๐ธ ๐น [ E แตโแตฅ ๐นโฒ ]หก [ Eโฒ แตโโข ๐นโณ ]หก with (pop y *แต) (E/Eโฒ (โ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y (x โข) = [ pop-y*E/Eโฒ แตโแตฅ โฃ-sym (/-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ) ]หก
   โแตฅโขหก-preserves ๐ธ ๐น [ E แถโแตฅ ๐นโฒ ]หก [ Eโฒ แถโโข ๐นโณ ]หก = [ _ แถโแตฅ โฃ-sym (/-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ) ]หก
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ ๐ธโณ โแตฅโข ๐นโณ ]หก =
      [ (pop y *แตแตโฃ) (/-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅ /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ]
   โแตฅโขหก-preserves {y = y} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ ๐ธโณ โแตฅโข ๐นโณ ]หก =
      [ (pop y *แตแตโฃ) (/-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅ /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ]
   โแตฅโขหก-preserves _ _ [ _ โแตฅ _ ] [ () ]
   โแตฅโขหก-preserves _ _ [ _ โแตฅแต _ ]หก [ () ]
   โแตฅโขหก-preserves _ _ [ _ โแตฅแถ _ ]หก [ () ]
   โแตฅโขหก-preserves _ _ [ _ แตโแตฅ _ ]หก [ () ]
   โแตฅโขหก-preserves _ _ [ _ แถโแตฅ _ ]หก [ () ]
   โแตฅโขหก-preserves _ _ [ _ โแตฅ _ ]หก [ () ]

   โแตฅแต-preserves : โ {ฮ} {P Q : Proc ฮ} {a aโณ x R Rโฒ Rโณ S} {aโฒโฃaโณ : ฯ แถ แดฌโฃ aโณ} {aโฃaโณ : a แต แดฌโฃ aโณ}
                  {E : P โ[ a แต - _ ]โ R} {Eโฒ : P โ[ (x โข) แต - _ ]โ Rโฒ} (๐ธ : E โฃ[ แตโแต ] Eโฒ)
                  (F : Q โ[ (โข x) แต - _ ]โ S) {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                  (๐ธโฒ : Eโฒ โแตฅ F โฃ[ aโฒโฃaโณ ] Eโณ) (๐ธโณ : E แตโ Q โฃ[ aโฃaโณ ] Eโณ) โ
                  Eโฒ/E (โ ๐ธ) โแตฅ (push *แต) F โฃ[ /-preserves-แดฌโฃ แตโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅแต-preserves {a = a} ๐ธ F [ _โแตฅโข_ {y = y} ๐ธโฒ ๐นโฒ ] [ ๐ธโณ โโขแต Fโฒ ] with (pop y *แต) (E/Eโฒ (โ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข (push *แตแถโฃ) ๐นโฒ ]
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅ ๐นโฒ ] [ ๐ธโณ โแตฅแต Fโฒ ] = [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ (push *แตแตโฃ) ๐นโฒ ]
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅแต .F ]หก [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ Q ] =
      [ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅแต (push *แต) F ]หก
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅแต .F ]หก [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ Q ] =
      [ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅแถ (push *แต) F ]หก
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ .F ]หก [ ๐ธโณ แตแถโ Q ] = [ /-preserves-โฃ ๐ธโณ ๐ธโฒ ๐ธ โแตฅแถ (push *แต) F ]หก
   โแตฅแต-preserves ๐ธ F [ E แตโแตฅ ๐นโฒ ]หก [ Eโฒ แตโแต Fโฒ ] = [ Eโฒ/E (โ ๐ธ) แตโแตฅ (push *แตแตโฃ) ๐นโฒ ]หก
   โแตฅแต-preserves ๐ธ F [ E แถโแตฅ ๐นโฒ ]หก [ Eโฒ แตโแถ Fโฒ ] = [ Eโฒ/E (โ ๐ธ) แถโแตฅ (push *แถแตโฃ) ๐นโฒ ]หก
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅ ๐นโฒ ]หก [ ๐ธโณ โแตฅแต Fโฒ ] = [ โฃ-sym (/-preserves-โฃ ๐ธโณ ๐ธโฒ ๐ธ) โแตฅ โฃ-sym ((push *แตแตโฃ) ๐นโฒ) ]
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅแต .F ]หก [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ Q ]หก = [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต (push *แต) F ]หก
   โแตฅแต-preserves ๐ธ F [ ๐ธโฒ โแตฅแต .F ]หก [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ Q ]หก = [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ (push *แต) F ]หก
   โแตฅแต-preserves _ _ [ _ โแตฅโข _ ] [ () ]หก
   โแตฅแต-preserves _ _ [ _ โแตฅ _ ] [ () ]หก
   โแตฅแต-preserves _ _ [ _ โแตฅแถ ._ ]หก [ () ]หก
   โแตฅแต-preserves _ _ [ _ แตโแตฅ _ ]หก [ () ]หก
   โแตฅแต-preserves _ _ [ _ แถโแตฅ _ ]หก [ () ]หก
   โแตฅแต-preserves _ _ [ _ โแตฅ _ ]หก [ () ]หก

   โแตฅแตหก-preserves : โ {ฮ} {P Q : Proc ฮ} {a aโณ x R Rโฒ Rโณ S} {aโฒโฃaโณ : a แต แดฌโฃ aโณ} {aโฃaโณ : ฯ แถ แดฌโฃ aโณ}
                  {E : P โ[ a แต - _ ]โ R} {Eโฒ : P โ[ (x โข) แต - _ ]โ Rโฒ} (๐ธ : E โฃ[ แตโแต ] Eโฒ)
                  (F : Q โ[ (โข x) แต - _ ]โ S) {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                  (๐ธโฒ : E แตโ Q โฃ[ aโฒโฃaโณ ] Eโณ) (๐ธโณ : Eโฒ โแตฅ F โฃ[ aโฃaโณ ] Eโณ) โ
                  ฮฝแต (E/Eโฒ (โ ๐ธ) แตโ S) โฃ[ /-preserves-แดฌโฃ แถโแต aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ โโขแต Fโฒ ] [ ๐ธโณ โแตฅโข ๐น ] = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโขแต Eโฒ/E (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแต Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ] = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต Eโฒ/E (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแต Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ] = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโขแต Eโฒ/E (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ E แตโแต Fโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐น ]หก = [ ฮฝแตแต [ E/Eโฒ (โ ๐ธ) แตโแต E/Eโฒ (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ E แตโแต Fโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐น ]หก = [ ฮฝโขแต [ E/Eโฒ (โ ๐ธ) แตโแถ E/Eโฒ (โ ๐น) ]หก ]หก
   โแตฅแตหก-preserves ๐ธ F [ E แตโแถ Fโฒ ] [ Eโฒ แถโแตฅ ๐น ]หก = [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แตโแถ E/Eโฒ (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแต Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต E/Eโฒ (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแต Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โโขแต E/Eโฒ (โ ๐น) ] ]
   โแตฅแตหก-preserves ๐ธ F [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโฒ Q ] [ ๐ธโณ โแตฅแต .F ]หก = [ ฮฝแตแต [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ แตแตโ _ ] ]
   โแตฅแตหก-preserves ๐ธ F [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโฒ Q ] [ ๐ธโณ โแตฅแต .F ]หก = [ ฮฝแตแต [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ แตแตโ _ ] ]
   โแตฅแตหก-preserves ๐ธ F [ ๐ธโฒ แตแถโ Q ] [ ๐ธโณ โแตฅแถ .F ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ แตแถโ _ ] ]
   โแตฅแตหก-preserves ๐ธ F [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโฒ Q ]หก [ ๐ธโณ โแตฅแต .F ]หก = [ ฮฝแตแต [ /-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ แตแตโ _ ] ]
   โแตฅแตหก-preserves ๐ธ F [ _แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโฒ Q ]หก [ ๐ธโณ โแตฅแต .F ]หก = [ ฮฝแตแต [ /-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ แตแตโ _ ] ]
   โแตฅแตหก-preserves _ _ [ _ แตโแต _ ] [ () ]
   โแตฅแตหก-preserves _ _ [ _ แตโแถ _ ] [ () ]
   โแตฅแตหก-preserves _ _ [ _ แตแตโ _ ] [ () ]
   โแตฅแตหก-preserves _ _ [ _ แตแถโ _ ] [ () ]
   โแตฅแตหก-preserves _ _ [ _ โโขแต _ ] [ () ]หก
   โแตฅแตหก-preserves _ _ [ _ แตแตโ _ ]หก [ () ]

   โแตฅแถ-preserves : โ {ฮ} {P Q : Proc ฮ} {a aโณ x R Rโฒ Rโณ S} {aโฒโฃaโณ : ฯ แถ แดฌโฃ aโณ} {aโฃaโณ : a แถ แดฌโฃ aโณ}
                  {E : P โ[ a แถ - _ ]โ R} {Eโฒ : P โ[ (x โข) แต - _ ]โ Rโฒ} (๐ธ : E โฃ[ แถโแต ] Eโฒ)
                  (F : Q โ[ (โข x) แต - _ ]โ S) {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                  (๐ธโฒ : Eโฒ โแตฅ F โฃ[ aโฒโฃaโณ ] Eโณ) (๐ธโณ : E แถโ Q โฃ[ aโฃaโณ ] Eโณ) โ
                  Eโฒ/E (โ ๐ธ) โแตฅ F โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅแถ-preserves ๐ธ F [ _โแตฅโข_ {y = y} ๐ธโฒ ๐น ] [ _โโขแถ_ {a = a} ๐ธโณ Fโฒ ] with (pop y *แถ) (E/Eโฒ (โ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข ๐น ]
   โแตฅแถ-preserves ๐ธ F [ ๐ธโฒ โแตฅ ๐น ] [ ๐ธโณ โแตฅแถ Fโฒ ] = [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ ๐น ]
   โแตฅแถ-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ .F ]หก [ ๐ธโณ แถแถโ Q ] = [ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅแถ F ]หก
   โแตฅแถ-preserves ๐ธ F [ Eโฒ แตโแตฅ ๐น ]หก [ E แถโแต Fโฒ ] = [ Eโฒ/E (โ ๐ธ) แตโแตฅ ๐น ]หก
   โแตฅแถ-preserves ๐ธ F [ Eโฒ แถโแตฅ ๐น ]หก [ E แถโแถ Fโฒ ] = [ Eโฒ/E (โ ๐ธ) แถโแตฅ ๐น ]หก
   โแตฅแถ-preserves ๐ธ F [ ๐ธโฒ โแตฅ ๐น ]หก [ ๐ธโณ โแตฅแถ Fโฒ ] = [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ โฃ-sym ๐น ]
   โแตฅแถ-preserves ๐ธ F [ ๐ธโฒ โแตฅแต .F ]หก [ ๐ธโณ แตแถโ Q ]หก = [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต F ]หก
   โแตฅแถ-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ .F ]หก [ ๐ธโณ แถแถโ Q ]หก = [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ F ]หก
   โแตฅแถ-preserves _ _ [ _ โแตฅโข _ ] [ () ]หก
   โแตฅแถ-preserves _ _ [ _ โแตฅ _ ] [ () ]หก
   โแตฅแถ-preserves _ _ [ _ โแตฅแต ._ ]หก [ () ]
   โแตฅแถ-preserves _ _ [ _ แตโแตฅ _ ]หก [ () ]หก
   โแตฅแถ-preserves _ _ [ _ แถโแตฅ _ ]หก [ () ]หก
   โแตฅแถ-preserves _ _ [ _ โแตฅ _ ]หก [ () ]หก

   โแตฅแถหก-preserves : โ {ฮ} {P Q : Proc ฮ} {a aโณ x R Rโฒ Rโณ S} {aโฒโฃaโณ : a แถ แดฌโฃ aโณ} {aโฃaโณ : ฯ แถ แดฌโฃ aโณ}
                  {E : P โ[ a แถ - _ ]โ R} {Eโฒ : P โ[ (x โข) แต - _ ]โ Rโฒ} (๐ธ : E โฃ[ แถโแต ] Eโฒ)
                  (F : Q โ[ (โข x) แต - _ ]โ S) {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                  (๐ธโฒ : E แถโ Q โฃ[ aโฒโฃaโณ ] Eโณ) (๐ธโณ : Eโฒ โแตฅ F โฃ[ aโฃaโณ ] Eโณ) โ
                  ฮฝแถ (E/Eโฒ (โ ๐ธ) แถโ S) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ โโขแถ Fโฒ ] [ ๐ธโณ โแตฅโข ๐น ] = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโขแถ Eโฒ/E (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ] = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ Eโฒ/E (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ] = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโขแถ Eโฒ/E (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ E แถโแต Fโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐น ]หก = [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แถโแต E/Eโฒ (โ ๐น) ]หก ]หก
   โแตฅแถหก-preserves ๐ธ F [ E แถโแต Fโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐น ]หก = [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโแถ E/Eโฒ (โ ๐น) ]หก ]หก
   โแตฅแถหก-preserves ๐ธ F [ E แถโแถ Fโฒ ] [ Eโฒ แถโแตฅ ๐น ]หก = [ ฮฝแถแถ [ E/Eโฒ (โ ๐ธ) แถโแถ E/Eโฒ (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ E/Eโฒ (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ โแตฅแถ Fโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐น ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โโขแถ E/Eโฒ (โ ๐น) ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ แถแถโ Q ] [ ๐ธโณ โแตฅแถ .F ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแต ๐ธ ๐ธโฒ ๐ธโณ แถแถโ _ ] ]
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ แตแถโ Q ]หก [ ๐ธโณ โแตฅแต .F ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแต ๐ธโณ ๐ธโฒ ๐ธ แตแถโ _ ] ]หก
   โแตฅแถหก-preserves ๐ธ F [ ๐ธโฒ แถแถโ Q ]หก [ ๐ธโณ โแตฅแถ .F ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแตแต ๐ธ ๐ธโฒ ๐ธโณ แถแถโ _ ] ]
   โแตฅแถหก-preserves _ _ [ _ แถโแต _ ] [ () ]
   โแตฅแถหก-preserves _ _ [ _ แถโแถ _ ] [ () ]
   โแตฅแถหก-preserves _ _ [ _ แถแถโ _ ] [ () ]
   โแตฅแถหก-preserves _ _ [ _ โโขแถ _ ] [ () ]หก
   โแตฅแถหก-preserves _ _ [ _ แตแถโ _ ]หก [ () ]
   โแตฅแถหก-preserves _ _ [ _ แถแถโ _ ]หก [ () ]

   แตโแตฅ-preserves : โ {ฮ} {P Q : Proc ฮ} {x a aโณ R Rโณ S Sโฒ} {aโฃaโฒ} {aโฒโฃaโณ} {aโฃaโณ} (E : P โ[ (x โข) แต - _ ]โ R) โ
                  {F : Q โ[ a แต - _ ]โ S} {Fโฒ : Q โ[ (โข x) แต - _ ]โ Sโฒ} (๐น : F โฃ[ aโฃaโฒ ] Fโฒ )
                  {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ} โ E โแตฅ Fโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : P โแต F โฃ[ aโฃaโณ ] Eโณ) โ
                  Eโฒ/E (โโ (E แตโแตฅ ๐น)) โฃ[ /-preserves-แดฌโฃ แตโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅโข ๐นโฒ ] [ Eโฒ แตโโข ๐นโณ ] = [ (push *แตแตโฃ) ๐ธ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅโข ๐นโฒ ] [ Eโฒ แตโโข ๐นโณ ] = [ (push *แตแตโฃ) ๐ธ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅ โฃ-sym (/-preserves-โฃ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅโข โฃ-sym (/-preserves-โฃ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅโข โฃ-sym (/-preserves-โฃ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แตโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แตโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แถโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แถโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แตโโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แตโโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แถโโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ] =
      [ (push *แต) E แถโโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ .E แถโแตฅ ๐นโฒ ]หก [ P โแตแถ ๐นโณ ] = [ (push *แต) E แถโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ .E แถโแตฅ ๐นโฒ ]หก [ P โแตแถ ๐นโณ ] = [ (push *แต) E แถโโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅ /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅ /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โแตฅโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) ๐ธ โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ ] =
      [ (push *แตแตโฃ) (โฃ-sym ๐ธ) โโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅแต Fโฒ ]หก [ Eโฒ แตโแต F ]หก = [ (push *แตแตโฃ) ๐ธ โแตฅแต Eโฒ/E (โ ๐น) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅแต Fโฒ ]หก [ Eโฒ แตโแต F ]หก = [ (push *แตแตโฃ) ๐ธ โโขแต Eโฒ/E (โ ๐น) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅแถ Fโฒ ]หก [ Eโฒ แถโแต F ]หก = [ (push *แถแตโฃ) ๐ธ โแตฅแถ Eโฒ/E (โ ๐น) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ ๐ธ โแตฅแถ Fโฒ ]หก [ Eโฒ แถโแต F ]หก = [ (push *แถแตโฃ) ๐ธ โโขแถ Eโฒ/E (โ ๐น) ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ .E แตโแตฅ ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก = [ (push *แต) E แตโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แถโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แถโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แตโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แตโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แถโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโฒ ]หก [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโณ ]หก =
      [ (push *แต) E แถโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แตโแตฅ-preserves _ _ [ _ โแตฅโข _ ] [ () ]หก
   แตโแตฅ-preserves _ _ [ _ โแตฅ _ ] [ () ]หก
   แตโแตฅ-preserves _ _ [ _ โแตฅแต _ ]หก [ () ]
   แตโแตฅ-preserves _ _ [ _ โแตฅแถ _ ]หก [ () ]
   แตโแตฅ-preserves _ _ [ ._ แถโแตฅ _ ]หก [ () ]หก
   แตโแตฅ-preserves _ _ [ _ โแตฅ _ ]หก [ () ]หก
-}
   แตโแตฅหก-preserves : โ {ฮ} {P Q : Proc ฮ} {x a aโณ R Rโณ S Sโฒ} {aโฃaโฒ} {aโฒโฃaโณ} {aโฃaโณ} (E : P โ[ (x โข) แต - _ ]โ R) โ
                  {F : Q โ[ a แต - _ ]โ S} {Fโฒ : Q โ[ (โข x) แต - _ ]โ Sโฒ} (๐น : F โฃ[ aโฃaโฒ ] Fโฒ )
                  {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ} โ P โแต F โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โแตฅ Fโฒ โฃ[ aโฃaโณ ] Eโณ) โ
                  E/Eโฒ (โโ (E แตโแตฅ ๐น)) โฃ[ /-preserves-แดฌโฃ แถโแต aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แตโโข ๐นโฒ ] [ ๐ธ โแตฅโข ๐นโณ ] = [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แตโโข ๐นโฒ ] [ ๐ธ โแตฅโข ๐นโณ ] = [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโแตฅ /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโแตฅ /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ] =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แตโแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แตโแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธ ๐นโณ ]หก =
      [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝแตแต [ _ โแตแต /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝแตแต [ _ โแตแต /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโขแต [ _ โแตแถ โฃ-sym (/-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโขแต [ _ โแตแถ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ]หก ]หก
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]หก
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ] [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโข [ _ โแถแถ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ P โแตแถ ๐นโฒ ] [ .E แถโแตฅ ๐นโณ ]หก = [ ฮฝแตแถ [ _ โแตแถ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ P โแตแถ ๐นโฒ ] [ .E แถโแตฅ ๐นโณ ]หก = [ ฮฝโขแถ [ _ โแถแถ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แตโแต F ]หก [ ๐ธ โแตฅแต Fโฒ ]หก = [ ฮฝแตแต [ E/Eโฒ (โ ๐ธ) แตโแต E/Eโฒ (โ ๐น) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แตโแต F ]หก [ ๐ธ โแตฅแต Fโฒ ]หก = [ ฮฝโขแต [ E/Eโฒ (โ ๐ธ) แตโแถ E/Eโฒ (โ ๐น) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แถโแต F ]หก [ ๐ธ โแตฅแถ Fโฒ ]หก = [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธ) แถโแต E/Eโฒ (โ ๐น) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ Eโฒ แถโแต F ]หก [ ๐ธ โแตฅแถ Fโฒ ]หก = [ ฮฝโขแถ [ E/Eโฒ (โ ๐ธ) แถโแถ E/Eโฒ (โ ๐น) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝแตแต [ _ โแตแต /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโขแต [ _ โแตแถ โฃ-sym (/-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ) ]หก ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝแตแต [ _ โแตแต /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโขแต [ _ โแตแถ /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ]หก ]หก
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ {!!} ]
   แตโแตฅหก-preserves {aโฃaโฒ = แตโแต} E ๐น [ _โแตแต_ {aโฃaโฒ = แตโแต} P ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก =
      [ ฮฝโข [ _ โแถแถ /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ] ]
   แตโแตฅหก-preserves _ _ [ _ โแตแต _ ] [ () ]
   แตโแตฅหก-preserves _ _ [ _ โแตแถ _ ] [ () ]
   แตโแตฅหก-preserves _ _ [ _ แตโโข _ ] [ () ]หก
   แตโแตฅหก-preserves _ _ [ _ แตโแต _ ]หก [ () ]
   แตโแตฅหก-preserves _ _ [ _ แถโแต _ ]หก [ () ]
   แตโแตฅหก-preserves _ _ [ _ โแตแต _ ]หก [ () ]
{-
   แถโแตฅ-preserves : โ {ฮ} {P Q : Proc ฮ} {x a aโณ R Rโณ S Sโฒ} {aโฒโฃaโณ} {aโฃaโณ} (E : P โ[ (x โข) แต - _ ]โ R) โ
                  {F : Q โ[ a แถ - _ ]โ S} {Fโฒ : Q โ[ (โข x) แต - _ ]โ Sโฒ} (๐น : F โฃ[ แถโแต ] Fโฒ )
                  {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ} โ E โแตฅ Fโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : P โแถ F โฃ[ aโฃaโณ ] Eโณ) โ
                  E โแตฅ Eโฒ/E (โ ๐น) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   แถโแตฅ-preserves E ๐น [ ๐ธ โแตฅโข ๐นโฒ ] [ Eโฒ แถโโข ๐นโณ ] = [ ๐ธ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แถโแตฅ-preserves E ๐น [ ๐ธ โแตฅ ๐นโฒ ] [ Eโฒ แถโแตฅ ๐นโณ ] = [ ๐ธ โแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ]
   แถโแตฅ-preserves E ๐น [ .E แถโแตฅ ๐นโฒ ]หก [ P โแถแถ ๐นโณ ] = [ E แถโแตฅ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก
   แถโแตฅ-preserves E ๐น [ ๐ธ โแตฅ ๐นโฒ ]หก [ Eโฒ แถโแตฅ ๐นโณ ] = [ โฃ-sym ๐ธ โแตฅ /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ]
   แถโแตฅ-preserves E ๐น [ ๐ธ โแตฅแต Fโฒ ]หก [ Eโฒ แตโแถ F ]หก = [ ๐ธ โแตฅแต Eโฒ/E (โ ๐น) ]หก
   แถโแตฅ-preserves E ๐น [ ๐ธ โแตฅแถ Fโฒ ]หก [ Eโฒ แถโแถ F ]หก = [ ๐ธ โแตฅแถ Eโฒ/E (โ ๐น) ]หก
   แถโแตฅ-preserves E ๐น [ .E แตโแตฅ ๐นโฒ ]หก [ P โแตแถ ๐นโณ ]หก = [ E แตโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แถโแตฅ-preserves E ๐น [ .E แถโแตฅ ๐นโฒ ]หก [ P โแถแถ ๐นโณ ]หก = [ E แถโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก
   แถโแตฅ-preserves _ _ [ _ โแตฅโข _ ] [ () ]หก
   แถโแตฅ-preserves _ _ [ _ โแตฅ _ ] [ () ]หก
   แถโแตฅ-preserves _ _ [ _ โแตฅแต _ ]หก [ () ]
   แถโแตฅ-preserves _ _ [ _ โแตฅแถ _ ]หก [ () ]
   แถโแตฅ-preserves _ _ [ ._ แตโแตฅ _ ]หก [ () ]
   แถโแตฅ-preserves _ _ [ _ โแตฅ _ ]หก [ () ]หก

   แถโแตฅหก-preserves : โ {ฮ} {P Q : Proc ฮ} {x a aโณ R Rโณ S Sโฒ} {aโฒโฃaโณ} {aโฃaโณ} (E : P โ[ (x โข) แต - _ ]โ R) โ
                  {F : Q โ[ a แถ - _ ]โ S} {Fโฒ : Q โ[ (โข x) แต - _ ]โ Sโฒ} (๐น : F โฃ[ แถโแต ] Fโฒ )
                  {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ} โ P โแถ F โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โแตฅ Fโฒ โฃ[ aโฃaโณ ] Eโณ) โ
                  (ฮฝแถ (R โแถ E/Eโฒ (โ ๐น))) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] (Eโฒ/E (โ ๐ธโณ))
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโโข ๐นโฒ ] [ ๐ธโณ โแตฅโข ๐นโณ ] = [ ฮฝแถแถ [ Eโฒ/E (โ ๐ธโณ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโแตฅ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] = [ ฮฝแถแถ [ Eโฒ/E (โ ๐ธโณ) แถโแตฅ /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโแตฅ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] = [ ฮฝแถแถ [ Eโฒ/E (โ ๐ธโณ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโแตฅ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก = [ ฮฝแถแถ [ E/Eโฒ (โ ๐ธโณ) แถโแตฅ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโแตฅ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก = [ ฮฝแถแถ [ E/Eโฒ (โ ๐ธโณ) แถโโข /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ P โแถแถ ๐นโฒ ] [ .E แถโแตฅ ๐นโณ ]หก = [ ฮฝแถแถ [ _ โแถแถ /-preserves-โฃแตแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves E ๐น [ Eโฒ แตโแถ F ]หก [ ๐ธโณ โแตฅแต Fโฒ ]หก = [ ฮฝแตแถ [ E/Eโฒ (โ ๐ธโณ) แตโแถ E/Eโฒ (โ ๐น) ] ]หก
   แถโแตฅหก-preserves E ๐น [ Eโฒ แถโแถ F ]หก [ ๐ธโณ โแตฅแถ Fโฒ ]หก = [ ฮฝแถแถ [ E/Eโฒ (โ ๐ธโณ) แถโแถ E/Eโฒ (โ ๐น) ]หก ]
   แถโแตฅหก-preserves E ๐น [ P โแตแถ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ ฮฝแตแถ [ _ โแตแถ โฃ-sym (/-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ) ] ]หก
   แถโแตฅหก-preserves E ๐น [ P โแตแถ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ ]หก = [ ฮฝโขแถ [ _ โแถแถ โฃ-sym (/-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ) ] ]หก
   แถโแตฅหก-preserves E ๐น [ P โแถแถ ๐นโฒ ]หก [ .E แถโแตฅ ๐นโณ ]หก = [ ฮฝแถแถ [ _ โแถแถ /-preserves-โฃแตแตแต ๐น ๐นโฒ ๐นโณ ] ]
   แถโแตฅหก-preserves _ _ [ _ โแถแถ _ ] [ () ]
   แถโแตฅหก-preserves _ _ [ _ แถโโข _ ] [ () ]หก
   แถโแตฅหก-preserves _ _ [ _ แตโแถ _ ]หก [ () ]
   แถโแตฅหก-preserves _ _ [ _ แถโแถ _ ]หก [ () ]
   แถโแตฅหก-preserves _ _ [ _ โแตแถ _ ]หก [ () ]
   แถโแตฅหก-preserves _ _ [ _ โแถแถ _ ]หก [ () ]

   โแตฅ-preserves : โ {ฮ} {P Q : Proc ฮ} {x u aโณ R Rโฒ Rโณ S Sโฒ} {โขxโฃโขu} {aโฒโฃaโณ} {aโฃaโณ}
                 {E : P โ[ (x โข) แต - _ ]โ R} {F : Q โ[ (โข x) แต - _ ]โ S}
                 {Eโฒ : P โ[ (u โข) แต - _ ]โ Rโฒ} {Fโฒ : Q โ[ (โข u) แต - _ ]โ Sโฒ} {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                 (๐ธ : E โฃ[ แตโแต ] Eโฒ) (๐น : F โฃ[ โขxโฃโขu ] Fโฒ) โ Eโฒ โแตฅ Fโฒ โฃ[ aโฒโฃaโณ ] Eโณ โ (๐ธโณ : E โแตฅ F โฃ[ aโฃaโณ ] Eโณ) โ
                 Eโฒ/E (โโ (๐ธ โแตฅ ๐น)) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฒโฃaโณ aโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅโข_ {y = y} ๐ธโฒ ๐นโฒ ] [ ๐ธโณ โแตฅโข ๐นโณ ] with (pop y *แต) (E/Eโฒ (โ ๐ธโณ))
   ... | pop-y*E/Eโณ = [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅโข_ {y = y} ๐ธโฒ ๐นโฒ ] [ ๐ธโณ โแตฅโข ๐นโณ ] with (pop y *แต) (E/Eโฒ (โ ๐ธโณ))
   ... | pop-y*E/Eโณ = [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃ ๐น ๐นโฒ ๐นโณ) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃ ๐น ๐นโฒ ๐นโณ) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃแดฐแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃแดฐแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแดฐแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแดฐแต ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแตแตแดฐ ๐ธโณ ๐ธโฒ ๐ธ โแตฅโข /-preserves-โฃแตแตแดฐ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแตแตแดฐ ๐ธโณ ๐ธโฒ ๐ธ โแตฅโข /-preserves-โฃแตแตแดฐ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแตแตแดฐ ๐ธโณ ๐ธโฒ ๐ธ โโข /-preserves-โฃแตแตแดฐ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ] [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแตแตแดฐ ๐ธโณ ๐ธโฒ ๐ธ โโข /-preserves-โฃแตแตแดฐ ๐นโณ ๐นโฒ ๐น ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅ /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ] =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแดฐ ๐ธ ๐ธโฒ ๐ธโณ โโข /-preserves-โฃแดฐแตแดฐ ๐น ๐นโฒ ๐นโณ ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ ๐ธโฒ โแตฅแต Fโฒ ]หก [ ๐ธโณ โแตฅแต F ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธโณ ๐ธโฒ ๐ธ โแตฅแต Eโฒ/E (โ ๐น) ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ ๐ธโฒ โแตฅแต Fโฒ ]หก [ ๐ธโณ โแตฅแต F ]หก = [ ฮฝแตแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธโณ ๐ธโฒ ๐ธ โโขแต Eโฒ/E (โ ๐น) ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ ๐ธโฒ โแตฅแถ Fโฒ ]หก [ ๐ธโณ โแตฅแถ F ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธโณ ๐ธโฒ ๐ธ โแตฅแถ Eโฒ/E (โ ๐น) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ ๐ธโฒ โแตฅแถ Fโฒ ]หก [ ๐ธโณ โแตฅแถ F ]หก = [ ฮฝแถแถ [ /-preserves-โฃแตแดฐแดฐ ๐ธโณ ๐ธโฒ ๐ธ โโขแถ Eโฒ/E (โ ๐น) ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ Eโฒ แตโแตฅ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโแตฅ /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโแตฅ /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝแตแถ [ Eโฒ/E (โ ๐ธ) แตโโข /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโฒ ]หก [ _แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโณ ]หก =
      [ ฮฝโขแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแตแดฐแดฐ ๐นโณ ๐นโฒ ๐น ] ]หก
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ Eโฒ แถโแตฅ ๐นโฒ ]หก [ E แถโแตฅ ๐นโณ ]หก = [ ฮฝแถแถ [ Eโฒ/E (โ ๐ธ) แถโแตฅ /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ Eโฒ แถโแตฅ ๐นโฒ ]หก [ E แถโแตฅ ๐นโณ ]หก = [ ฮฝแถแถ [ Eโฒ/E (โ ๐ธ) แถโโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅ โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅ โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ /-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ โแตฅโข /-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ ]หก ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โโข โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โแตฅโข โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves {โขxโฃโขu = แตโแต} ๐ธ ๐น [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโฒ ๐นโฒ ]หก [ _โแตฅ_ {โขxโฃโขu = แตโแต} ๐ธโณ ๐นโณ ]หก =
      [ ฮฝแถแถ [ โฃ-sym (/-preserves-โฃแดฐแตแต ๐ธ ๐ธโฒ ๐ธโณ) โโข โฃ-sym (/-preserves-โฃแดฐแตแต ๐น ๐นโฒ ๐นโณ) ] ]
   โแตฅ-preserves _ _ [ _ โแตฅโข _ ] [ () ]หก
   โแตฅ-preserves _ _ [ _ โแตฅแต _ ]หก [ () ]
   โแตฅ-preserves _ _ [ _ โแตฅแถ _ ]หก [ () ]
   โแตฅ-preserves _ _ [ _ แตโแตฅ _ ]หก [ () ]
   โแตฅ-preserves _ _ [ _ แถโแตฅ _ ]หก [ () ]
-}

{-
   /-preserves-โฃ [ ๐ธ โแตฅโข ๐น ] = โแตฅโข-preserves ๐ธ ๐น
   /-preserves-โฃ [ ๐ธ โแตฅโข ๐น ]หก = โแตฅโขหก-preserves ๐ธ ๐น
   /-preserves-โฃ [ ๐ธ โแตฅแต F ] = โแตฅแต-preserves ๐ธ F
   /-preserves-โฃ [ ๐ธ โแตฅแต F ]หก = โแตฅแตหก-preserves ๐ธ F
   /-preserves-โฃ [ ๐ธ โแตฅแถ F ] = โแตฅแถ-preserves ๐ธ F
   /-preserves-โฃ [ ๐ธ โแตฅแถ F ]หก = โแตฅแถหก-preserves ๐ธ F
   /-preserves-โฃ [ E แตโแตฅ ๐น ] = แตโแตฅ-preserves E ๐น
   /-preserves-โฃ [ E แตโแตฅ ๐น ]หก = แตโแตฅหก-preserves E ๐น
   /-preserves-โฃ [ E แถโแตฅ ๐น ] = แถโแตฅ-preserves E ๐น
   /-preserves-โฃ [ E แถโแตฅ ๐น ]หก = แถโแตฅหก-preserves E ๐น
   /-preserves-โฃ [ ๐ธ โแตฅ ๐น ] = โแตฅ-preserves ๐ธ ๐น
-}

   โแตฅหก-preserves : โ {ฮ} {P Q : Proc ฮ} {x u aโณ R Rโฒ Rโณ S Sโฒ} {โขxโฃโขu} {aโฒโฃaโณ} {aโฃaโณ}
                 {E : P โ[ (x โข) แต - _ ]โ R} {F : Q โ[ (โข x) แต - _ ]โ S}
                 {Eโฒ : P โ[ (u โข) แต - _ ]โ Rโฒ} {Fโฒ : Q โ[ (โข u) แต - _ ]โ Sโฒ} {Eโณ : P โ Q โ[ aโณ - _ ]โ Rโณ}
                 (๐ธ : E โฃ[ แตโแต ] Eโฒ) (๐น : F โฃ[ โขxโฃโขu ] Fโฒ) โ E โแตฅ F โฃ[ aโฃaโณ ] Eโณ โ (๐ธโณ : Eโฒ โแตฅ Fโฒ โฃ[ aโฒโฃaโณ ] Eโณ) โ
                 E/Eโฒ (โโ (๐ธ โแตฅ ๐น)) โฃ[ /-preserves-แดฌโฃ แถโแถ aโฃaโณ aโฒโฃaโณ ] Eโฒ/E (โ ๐ธโณ)
   โแตฅหก-preserves ๐ธ ๐น ๐ธโฒ ๐ธโณ = {!!}

   /-preserves-โฃ [ ๐ธ โแตฅ ๐น ]หก = โแตฅหก-preserves ๐ธ ๐น

{-
   /-preserves-โฃ (๐ธ แถแตโ Q) (Eโฒ แตโแต F) (E แถโแต .F) = Eโฒ/E (โโ ๐ธ) แตโแต F
   /-preserves-โฃ (๐ธ แถแตโ Q) (Eโฒ แตโแถ F) (E แถโแถ .F) = Eโฒ/E (โโ ๐ธ) แตโแถ F
   /-preserves-โฃ (๐ธ แถแตโ Q) (๐ธโฒ โโขแต F) (_โโขแถ_ {y = y} {a = a} ๐ธโณ .F) with (pop y *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแต F
   /-preserves-โฃ (๐ธ แถแตโ Q) (๐ธโฒ โแตฅแต F) (๐ธโณ โแตฅแถ .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต F
   /-preserves-โฃ (๐ธ แถแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แถแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแตโ Q
   /-preserves-โฃ (๐ธ แถแตโ Q) (๐ธโฒ แตแถโ .Q) (๐ธโณ แถแถโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแถโ Q

   /-preserves-โฃ (P โแถแต ๐น) (E แตโโข ๐นโฒ) (.E แถโโข ๐นโณ) = E แตโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแต ๐น) (E แตโแตฅ ๐นโฒ) (.E แถโแตฅ ๐นโณ) = E แตโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแต ๐น) (.P โแตแต ๐นโฒ) (.P โแถแต ๐นโณ) = P โแตแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแต ๐น) (.P โแตแถ ๐นโฒ) (.P โแถแถ ๐นโณ) = P โแตแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (๐ธ แตแถโ Q) (๐ธโฒ แถแตโ .Q) (_แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแตโ (push *) Q
   /-preserves-โฃ (๐ธ แตแถโ Q) (๐ธโฒ แถแตโ .Q) (_แตแตโ_ {aโฃaโฒ = แตโแต} ๐ธโณ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ (push *) Q
   /-preserves-โฃ (๐ธ แตแถโ Q) (E แถโแต F) (Eโฒ แตโแต .F) = Eโฒ/E (โโ ๐ธ) แถโแต (push *แต) F
   /-preserves-โฃ (๐ธ แตแถโ Q) (E แถโแถ F) (Eโฒ แตโแถ .F) = Eโฒ/E (โโ ๐ธ) แถโแถ (push *แถ) F
   /-preserves-โฃ (๐ธ แตแถโ Q) (๐ธโฒ โแตฅแถ F) (๐ธโณ โแตฅแต .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ (push *แต) F
   /-preserves-โฃ (๐ธ แตแถโ Q) (๐ธโฒ โโขแถ F) (_โโขแต_ {y = y} {a = a} ๐ธโณ .F) with (pop y *แต) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแถ (push *แถ) F
   /-preserves-โฃ (๐ธ แตแถโ Q) (๐ธโฒ แถแถโ .Q) (๐ธโณ แตแถโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ (push *) Q

   /-preserves-โฃ (P โแตแถ ๐น) (.P โแถแต ๐นโฒ) (_โแตแต_ {aโฃaโฒ = แตโแต} .P ๐นโณ) = (push *) P โแถแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแตแถ ๐น) (.P โแถแต ๐นโฒ) (_โแตแต_ {aโฃaโฒ = แตโแต} .P ๐นโณ) = (push *) P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแตแถ ๐น) (E แถโโข ๐นโฒ) (.E แตโโข ๐นโณ) = (push *แต) E แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแตแถ ๐น) (E แถโแตฅ ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) = (push *แต) E แถโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแตแถ ๐น) (E แถโแตฅ ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) = (push *แต) E แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแตแถ ๐น) (.P โแถแถ ๐นโฒ) (.P โแตแถ ๐นโณ) = (push *) P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (๐ธ แถแถโ Q) (๐ธโฒ แถแตโ .Q) (๐ธโณ แถแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแตโ Q
   /-preserves-โฃ (๐ธ แถแถโ Q) (E แถโแต F) (Eโฒ แถโแต .F) = Eโฒ/E (โโ ๐ธ) แถโแต F
   /-preserves-โฃ (๐ธ แถแถโ Q) (E แถโแถ F) (Eโฒ แถโแถ .F) = Eโฒ/E (โโ ๐ธ) แถโแถ F
   /-preserves-โฃ (๐ธ แถแถโ Q) (๐ธโฒ โโขแถ F) (_โโขแถ_ {y = y} {a = a} ๐ธโณ .F) with (pop y *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแถ F
   /-preserves-โฃ (๐ธ แถแถโ Q) (๐ธโฒ โแตฅแถ F) (๐ธโณ โแตฅแถ .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ F
   /-preserves-โฃ (๐ธ แถแถโ Q) (๐ธโฒ แถแถโ .Q) (๐ธโณ แถแถโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ Q

   /-preserves-โฃ (P โแถแถ ๐น) (.P โแถแต ๐นโฒ) (.P โแถแต ๐นโณ) = P โแถแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแถ ๐น) (E แถโโข ๐นโฒ) (.E แถโโข ๐นโณ) = _ แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแถ ๐น) (E แถโแตฅ ๐นโฒ) (.E แถโแตฅ ๐นโณ) = E แถโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (P โแถแถ ๐น) (.P โแถแถ ๐นโฒ) (.P โแถแถ ๐นโณ) = P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (E แตโแต F) (Eโฒ แตโโข ๐นโฒ) (_โโขแต_ {y = y} {a = a} ๐ธ Fโฒ) with (pop y *แต) (E/Eโฒ (โโ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y a = Eโฒ/E (โโ ๐ธ) แตโโข (push *แตแถโฃ) ๐นโฒ
   /-preserves-โฃ (E แตโแต F) (Eโฒ แตโแตฅ ๐น) (๐ธ โแตฅแต Fโฒ) = Eโฒ/E (โโ ๐ธ) แตโแตฅ (push *แตแตโฃ) ๐น
   /-preserves-โฃ {aโฒโฃaโณ = แตโแต} (E แตโแต F) (P โแตแต ๐น) (.E แตโแต Fโฒ) = _ โแตแต (push *แตแตโฃ) ๐น
   /-preserves-โฃ {aโฒโฃaโณ = แตโแต} (E แตโแต F) (P โแตแต ๐น) (.E แตโแต Fโฒ) = _ โแตแต (push *แตแตโฃ) ๐น
   /-preserves-โฃ (E แตโแต F) (P โแตแถ ๐น) (.E แตโแถ Fโฒ) = _ โแตแถ (push *แตแถโฃ) ๐น

   /-preserves-โฃ (E แตโแถ F) (P โแถแต ๐น) (.E แตโแต Fโฒ) = _ โแถแต (push *แถแตโฃ) ๐น
   /-preserves-โฃ (E แตโแถ F) (Eโฒ แถโโข ๐นโฒ) (_โโขแต_ {y = y} {a = a} ๐ธ Fโฒ) with (pop y *แต) (E/Eโฒ (โโ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y a = Eโฒ/E (โโ ๐ธ) แถโโข (push *แถแถโฃ) ๐นโฒ
   /-preserves-โฃ (E แตโแถ F) (Eโฒ แถโแตฅ ๐น) (๐ธ โแตฅแต Fโฒ) = Eโฒ/E (โโ ๐ธ) แถโแตฅ (push *แถแตโฃ) ๐น
   /-preserves-โฃ (E แตโแถ F) (P โแถแถ ๐น) (.E แตโแถ Fโฒ) = _ โแถแถ (push *แถแถโฃ) ๐น

   /-preserves-โฃ (E แถโแต F) (Eโฒ แตโโข ๐นโฒ) (_โโขแถ_ {y = y} {a = a} ๐ธโณ Fโฒ) with (pop y *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = Eโฒ/E (โโ ๐ธโณ) แตโโข ๐นโฒ
   /-preserves-โฃ (E แถโแต F) (Eโฒ แตโแตฅ ๐น) (๐ธ โแตฅแถ Fโฒ) = Eโฒ/E (โโ ๐ธ) แตโแตฅ ๐น
   /-preserves-โฃ {aโฒโฃaโณ = แตโแต} (E แถโแต F) (P โแตแต ๐น) (.E แถโแต Fโฒ) = _ โแตแต ๐น
   /-preserves-โฃ {aโฒโฃaโณ = แตโแต} (E แถโแต F) (P โแตแต ๐น) (.E แถโแต Fโฒ) = _ โแตแต ๐น
   /-preserves-โฃ (E แถโแต F) (P โแตแถ ๐นโฒ) (.E แถโแถ Fโฒ) = _ โแตแถ ๐นโฒ

   /-preserves-โฃ (E แถโแถ F) (P โแถแต ๐น) (.E แถโแต Fโฒ) = _ โแถแต ๐น
   /-preserves-โฃ (E แถโแถ F) (Eโฒ แถโโข ๐น) (_โโขแถ_ {y = y} {a = a} ๐ธ Fโฒ) with (pop y *แถ) (E/Eโฒ (โโ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y a = Eโฒ/E (โโ ๐ธ) แถโโข ๐น
   /-preserves-โฃ (E แถโแถ F) (Eโฒ แถโแตฅ ๐น) (๐ธ โแตฅแถ Fโฒ) = Eโฒ/E (โโ ๐ธ) แถโแตฅ ๐น
   /-preserves-โฃ (E แถโแถ F) (P โแถแถ ๐นโฒ) (.E แถโแถ Fโฒ) = _ โแถแถ ๐นโฒ

   /-preserves-โฃ (๐ธ โโ Q) (๐ธโฒ โโ .Q) (๐ธโณ โโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ

   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (E แตโแต F) (Eโฒ แตโแต .F) = _ แตโแต (push *แต) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (E แตโแต F) (Eโฒ แตโแต .F) = _ แถโแต (push *แต) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (E แตโแถ F) (Eโฒ แตโแถ .F) = _ แตโแถ (push *แถ) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (E แตโแถ F) (Eโฒ แตโแถ .F) = _ แถโแถ (push *แถ) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ โแตฅแต F) (๐ธโณ โแตฅแต .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแต (push *แต) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ โแตฅแต F) (๐ธโณ โแตฅแต .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โแตฅแถ (push *แต) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ โโขแต F) (_โโขแต_ {y = y} {a = a} ๐ธโณ .F) with (pop y *แต) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโณ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแต (push *แถ) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ โโขแต F) (๐ธโณ โโขแต .F) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแถ (push *แถ) F
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) =
      /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแตโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) =
      /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแถโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) =
      /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแตโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) =
      /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแถโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {แตโแต} {แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแตโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {แตโแต} {แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {แตโแต} {แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแตโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {แตโแต} {แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแตโ .Q) (๐ธโณ แตแตโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแถโ .Q) (๐ธโณ แตแถโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แตแถโ (push *) Q
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (๐ธ แตแตโ Q) (๐ธโฒ แตแถโ .Q) (๐ธโณ แตแถโ .Q) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ แถแถโ (push *) Q

   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (E แตโโข ๐นโฒ) (.E แตโโข ๐นโณ) = (push *แต) E แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (E แตโโข ๐นโฒ) (.E แตโโข ๐นโณ) = (push *แต) E แตโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แตโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แตโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แตโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แตโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แถโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แถโแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} E ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} .E ๐นโณ) =
      (push *แต) E แถโโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแตแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแตแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแตแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแถแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแถแต /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} {aโฒโฃaโณ = แตโแต} {aโฃaโณ = แตโแต} (P โแตแต ๐น) (.P โแตแต ๐นโฒ) (.P โแตแต ๐นโณ) =
      (push *) P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (.P โแตแถ ๐นโฒ) (.P โแตแถ ๐นโณ) = (push *) P โแตแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ {aโฃaโฒ = แตโแต} (P โแตแต ๐น) (.P โแตแถ ๐นโฒ) (.P โแตแถ ๐นโณ) = (push *) P โแถแถ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (_โโขแต_ {y = y} {a = a} ๐ธ F) (๐ธโฒ โโข ๐น) (_โโขแต_ {y = z} {a = .a} ๐ธโณ Fโฒ)
      with (pop y *แต) (E/Eโฒ (โโ ๐ธ)) | (pop z *แต) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโฒ | pop-y*E/Eโณ rewrite popโpush y a | popโpush z a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข (push *แถแถโฃ) ๐น
   /-preserves-โฃ (_โโขแต_ {y = y} {a = a} ๐ธ F) (๐ธโฒ โโขแตฅ ๐น) (๐ธโณ โแตฅแต Fโฒ) with (pop y *แต) (E/Eโฒ (โโ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแตฅ (push *แถแตโฃ) ๐น

   /-preserves-โฃ (_โโขแถ_ {y = y} {a = a} ๐ธ F) (_โโข_ {x = x} {.y} {u} {z} ๐ธโฒ ๐น) (๐ธโณ โโขแถ Fโฒ)
      with (pop y *แถ) (E/Eโฒ (โโ ๐ธ)) | (pop y *แต) (Eโฒ/E (โโ ๐ธโฒ)) | (pop z *แต) (E/Eโฒ (โโ ๐ธโฒ)) | (pop z *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | pop-y*E/Eโฒ | pop-y*Eโณ/Eโฒ | pop-z*Eโฒ/Eโณ | pop-z*E/Eโณ
      rewrite popโpush y a | popโpush u y | popโpush x z | popโpush z a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโข ๐น
   /-preserves-โฃ (_โโขแถ_ {y = y} {a = a} ๐ธ F) (๐ธโฒ โโขแตฅ ๐นโฒ) (๐ธโณ โแตฅแถ Fโฒ) with (pop y *แถ) (E/Eโฒ (โโ ๐ธ))
   ... | pop-y*E/Eโฒ rewrite popโpush y a = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ โโขแตฅ ๐นโฒ

   /-preserves-โฃ (E แตโโข ๐น) (๐ธ โโข ๐นโฒ) (Eโฒ แตโโข ๐นโณ) = (push *แตแตโฃ) ๐ธ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (E แตโโข ๐น) (๐ธ โโขแตฅ ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ) = (push *แตแตโฃ) ๐ธ โโขแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (E แตโโข ๐น) (๐ธ โโขแตฅ ๐นโฒ) (_แตโแตฅ_ {aโฃaโฒ = แตโแต} Eโฒ ๐นโณ) = (push *แตแตโฃ) ๐ธ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (E แถโโข ๐น) (๐ธโฒ โโข ๐นโฒ) (Eโฒ แถโโข ๐นโณ) = ๐ธโฒ โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (E แถโโข ๐น) (๐ธโฒ โโขแตฅ ๐นโฒ) (Eโฒ แถโแตฅ ๐นโณ) = ๐ธโฒ โโขแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (๐ธ โโข ๐น) (๐ธโฒ โโข ๐นโฒ) (๐ธโณ โโข ๐นโณ) = (pop _ *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ) โโข /-preserves-โฃ ๐น ๐นโฒ ๐นโณ
   /-preserves-โฃ (๐ธ โโข ๐น) (๐ธโฒ โโขแตฅ ๐นโฒ) (๐ธโณ โโขแตฅ ๐นโณ) = (pop _ *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ) โโขแตฅ /-preserves-โฃ ๐น ๐นโฒ ๐นโณ

   /-preserves-โฃ (ฮฝโข ๐ธ) (ฮฝโข ๐ธโฒ) (ฮฝโข ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝโข ๐ธ) (ฮฝโขแต ๐ธโฒ) (ฮฝโขแต ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝโข ๐ธ) (ฮฝโขแถ ๐ธโฒ) (ฮฝโขแถ ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ

   /-preserves-โฃ (ฮฝโขแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝโขแต ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝโขแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝโขแต ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝโขแต ๐ธ) (ฮฝแตแถ ๐ธโฒ) (ฮฝโขแถ ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ

   /-preserves-โฃ (ฮฝโขแถ ๐ธ) (ฮฝแถแถ ๐ธโฒ) (ฮฝโขแถ ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝโขแถ ๐ธ) (ฮฝแถแต ๐ธโฒ) (ฮฝโขแต ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ

   /-preserves-โฃ (ฮฝแตแต_ {a = x โข} {a} ๐ธ) (ฮฝแตแต_ {aโฒ = aโฒ} ๐ธโฒ) (ฮฝแตแต ๐ธโณ)
      with (swap *แต) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush x | swapโpushโpush a | swapโpushโpush aโฒ =
      ฮฝแตแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = u โข} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = โข y} ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = โข u} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = โข y} ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = โข u} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = y โข} ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = u โข} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = y โข} ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = u โข} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแตแถ (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {aโฒ = โข u} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแตแถ (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = x โข} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแตแต (swap *แตแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแตแถ (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต_ {a = x โข} {a} ๐ธ) (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธโฒ) (ฮฝแตแถ ๐ธโณ)
      with (swap *แต) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush a | swapโpushโpush aโฒ = ฮฝแตแถ swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {u โข} ๐ธ) (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธโฒ) (ฮฝแตแถ ๐ธโณ)
      with (swap *แต) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแตแถ swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต_ {a = โข x} {โข u} ๐ธ) (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธโฒ) (ฮฝแตแถ ๐ธโณ)
      with (swap *แต) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แตแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแตแถ swap*Eโฒ/๐ธโณ/E

   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E = ฮฝแถแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแถแถ (swap *แถแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธโฒ) (ฮฝแตแถ ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แถแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแถแถ swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = x โข} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E = ฮฝแถแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต_ {aโฒ = โข x} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E = ฮฝแถแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแต ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ) = ฮฝแถแถ (swap *แถแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)

   /-preserves-โฃ (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธ) (ฮฝแถแถ ๐ธโฒ) (ฮฝแตแถ_ {aโฒ = aโณ} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) | (swap *แถแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ | swapโpushโpush aโณ = ฮฝแถแถ swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแถ ๐ธ) (ฮฝแถแต_ {a = a} {aโฒ} ๐ธโฒ) (ฮฝแตแต_ {a = x โข} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (E/Eโฒ (โโ ๐ธโณ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) |
           (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*E/Eโณ | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush a | swapโpushโpush aโฒ =
      ฮฝแถแต swap*Eโฒ/๐ธโณ/E

   /-preserves-โฃ (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธ) (ฮฝแถแต ๐ธโฒ) (ฮฝแตแต_ {a = โข x} {u โข} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (E/Eโฒ (โโ ๐ธโณ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) |
           (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*E/Eโณ | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแถแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธ) (ฮฝแถแต ๐ธโฒ) (ฮฝแตแต_ {a = โข x} {โข u} ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แต) (E/Eโฒ (โโ ๐ธโณ)) | (swap *แต) (Eโฒ/E (โโ ๐ธโณ)) |
           (swap *แถแตโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*E/Eโณ | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแถแต swap*Eโฒ/๐ธโณ/E
   /-preserves-โฃ (ฮฝแตแถ_ {aโฒ = aโฒ} ๐ธ) (ฮฝแถแต ๐ธโฒ) (ฮฝแตแต ๐ธโณ)
      with (swap *แถ) (Eโฒ/E (โโ ๐ธ)) | (swap *แถ) (E/Eโฒ (โโ ๐ธโณ)) | (swap *แถ) (Eโฒ/E (โโ ๐ธโณ)) |
           (swap *แถแถโฃ) (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)
   ... | swap*Eโฒ/E | swap*E/Eโณ | swap*Eโณ/E | swap*Eโฒ/๐ธโณ/E rewrite swapโpushโpush aโฒ = ฮฝแถแถ swap*Eโฒ/๐ธโณ/E

   /-preserves-โฃ (ฮฝแถแต_ {a = a} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแถแต ๐ธโณ) with (swap *แถ) (E/Eโฒ (โโ ๐ธ)) | (swap *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | swap*E/Eโฒ | swap*E/Eโณ rewrite swapโpushโpush a = ฮฝแตแต /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝแถแต_ {a = a} ๐ธ) (ฮฝแตแต ๐ธโฒ) (ฮฝแถแต ๐ธโณ) with (swap *แถ) (E/Eโฒ (โโ ๐ธ)) | (swap *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | swap*E/Eโฒ | swap*E/Eโณ rewrite swapโpushโpush a = ฮฝแตแต /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝแถแต_ {a = a} ๐ธ) (ฮฝแตแถ ๐ธโฒ) (ฮฝแถแถ ๐ธโณ) with (swap *แถ) (E/Eโฒ (โโ ๐ธ))
   ... | swap*E/Eโฒ rewrite swapโpushโpush a = ฮฝแตแถ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ

   /-preserves-โฃ (ฮฝแถแถ ๐ธ) (ฮฝแถแถ ๐ธโฒ) (ฮฝแถแถ ๐ธโณ) = ฮฝแถแถ /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
   /-preserves-โฃ (ฮฝแถแถ_ {a = a} ๐ธ) (ฮฝแถแต ๐ธโฒ) (ฮฝแถแต ๐ธโณ) with (swap *แถ) (E/Eโฒ (โโ ๐ธโณ))
   ... | swap*E/Eโณ rewrite swapโpushโpush a = ฮฝแถแต (/-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ)

   /-preserves-โฃ (! ๐ธ) (! ๐ธโฒ) (! ๐ธโณ) = /-preserves-โฃ ๐ธ ๐ธโฒ ๐ธโณ
-}
   /-preserves-โฃ _ _ _ = {!!}
